<!DOCTYPE html>
<html>
    <head>
        <meta charset = "UTF-8">
        <title>  </title>
        <link rel = "stylesheet" type = "text/css" href = "main.css">
    </head>
    <body>
        <h1>Welcome to INTERNET SHOP</h1>
        <p><span class = "page">메인페이지</span>&nbsp;
            <a href = "login.html">로그인</a>&nbsp;
            <a href = "signup.html">회원가입</a><hr class = "head">
        </p>
        <div>
            <aside>
                <form>
                    <div>&nbsp;&nbsp;&nbsp;Choose a category:<br>
                        <label><select id="category">
                            <option selected>All</option>
                            <option>CPU</option>
                            <option>MainBoard</option>
                            <option>GraphicsCard</option>
                        </select></label></div>
                    <div>&nbsp;&nbsp;&nbsp;Enter search term:<br>
                        <label><input type="text" id="searchTerm" placeholder="e.g. CPU"></label></div>
                    <div>&nbsp;&nbsp;&nbsp;<button>Filter results</button></div>
                </form>
            </aside>
            <main></main>
        </div>
        <script>
            fetch('product.json').then(function(response) {
                return response.json();})
                .then(function(json) {
                    let product = json;
                    initialize(product);})
                    .catch(function(err) {
                        console.log('Fetch problem: ' + err.message);});
                    function initialize(product) {
                        let category = document.querySelector('#category');
                        let searchTerm = document.querySelector('#searchTerm');
                        let searchButton = document.querySelector('button');
                        let main = document.querySelector('main');
                        let lastCategory = category.value;
                        let lastSearch = '';
                        let categoryGroup;
                        let finalGroup;
                        finalGroup = product;
                        updateDisplay();
                        categoryGroup = [];
                        finalGroup = [];
                        searchButton.onclick = selectCategory;
                        function selectCategory(e) {
                            e.preventDefault();
                            categoryGroup = [];
                            finalGroup = [];
                            if(category.value === lastCategory && searchTerm.value.trim() === lastSearch) {
                                return;
                            } else {
                                lastCategory = category.value;
                                lastSearch = searchTerm.value.trim();
                                if(category.value === 'All') {
                                    categoryGroup = product;
                                    selectProduct();
                                } else {
                                    for(let i = 0; i < product.length ; i++) {
                                        if(product[i].category === category.value) {
                                            categoryGroup.push(product[i]);
                                        }
                                    }
                                    selectProduct();
                                }
                            }
                        }
                        function selectProduct() {
                            let term = searchTerm.value.trim();
                            if(term === '') {
                                finalGroup = categoryGroup;
                                updateDisplay();
                            } else {
                                for(let i = 0; i < categoryGroup.length ; i++) {
                                    if(categoryGroup[i].name.indexOf(term) !== -1) {
                                        finalGroup.push(categoryGroup[i]);
                                    }
                                }
                                updateDisplay();
                            }
                        }
                        function updateDisplay() {
                            while (main.firstChild) {
                                main.removeChild(main.firstChild);
                            }
                            if(finalGroup.length === 0) {
                                let para = document.createElement('p');
                                para.textContent = 'No results to display!';
                                main.appendChild(para);
                            } else {
                                for(let i = 0; i < finalGroup.length; i++) {
                                    let product = finalGroup[i];
                                    showProduct(product.image, product)
                                }
                            }
                        }
                        function showProduct(imageroute, product) {
                            let section = document.createElement('section');
                            let span = document.createElement('span');
                            let image = document.createElement('img');
                            section.setAttribute('class', product.category);
                            span.textContent = "Click to see more";
                            span.onclick = addData(section, product);
                            image.src = imageroute;
                            image.alt = product.name;
                            // append the elements to the DOM as appropriate, to add the product to the UI
                            main.appendChild(section);
                            section.appendChild(span);
                            section.appendChild(para);
                            section.appendChild(image);
                        }
                        function addData(section, product) {
                            let head = document.createElement('h2');
                            let cost = document.createElement('p');
                            head.textContent = product.name;
                            cost.textContent = '$' + product.cost.toFixed(2);
                            section.appendChild(head);
                            section.appendChild(cost);
                        }
                    }
        </script>
    </body>
</html>